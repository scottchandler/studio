/**
 * Videos Plugin Assets
 *
 * @package   Videos Plugin
 * @author    Benjamin David
 * @copyright Copyright (c) 2013, Dukt
 * @license   http://dukt.net/
 * @link      http://dukt.net/
 */"use strict";var videos=angular.module("videos",["localization"]).value("$anchorScroll",angular.noop).config(["$routeProvider",function(e,t){var n=DuktVideosCms.getResourceUrl("lib/videos/angular/partials/empty.html");e.when("/",{templateUrl:n,controller:ServicesListCtrl}).when("/:serviceKey",{templateUrl:n,controller:ServicesListCtrl}).when("/:serviceKey/:methodName",{templateUrl:n,controller:ServicesListCtrl}).when("/:serviceKey/:methodName/:playlistId",{templateUrl:n,controller:ServicesListCtrl}).otherwise({redirectTo:"/"})}]);videos.factory("VideosService",function(e,t){var n={appLoaded:!1,searchQuery:"",searchInProgress:!1,currentService:!1,currentMethod:!1,services:!1,loader:{on:function(){$(".dkv-main .dkv-reload").addClass("dkv-loading");$(".dkv-player .dkv-spinner").removeClass("dkv-hidden")},off:function(){$(".dkv-main .dkv-reload").removeClass("dkv-loading");$(".dkv-player .dkv-spinner").addClass("dkv-hidden")}},videoMore:{on:function(){$(".dkv-video-more").css("display","block")},off:function(){$(".dkv-video-more").css("display","none")},loadingOn:function(){$(".dkv-video-more .dkv-btn").addClass("dkv-loading")},loadingOff:function(){$(".dkv-video-more .dkv-btn").removeClass("dkv-loading")},isLoading:function(){return $(".dkv-video-more .dkv-btn").hasClass("dkv-loading")}}};return n});videos.directive("clickAnywhereButHere",function(e){return{restrict:"A",link:function(t,n,r,i){n.bind("click",function(e){e.stopPropagation()});e.bind("click",function(){t.$apply(r.clickAnywhereButHere)})}}});videos.run(function(e,t,n,r,i,s,o){function a(){$(".dkv-search .dkv-press-enter").addClass("dkv-hidden");var t=new RegExp("/.*/search"),r=n.path().match(t);r||n.path(i.serviceKey+"/search");var s=o.searchQuery;s!=""?f(i,s,o):e.$apply(function(){e.videos=[];$(".dkv-videos .dkv-video-more").css("display","none");$(".dkv-main .dkv-empty").css("display","block");setTimeout(function(){dkvideos.modal.resize()},10)})}function f(n,r,i){var s={method:"search",providerClass:n.serviceKey,searchQuery:r,page:1,perPage:Dukt_videos.pagination_per_page};i.loader.on();t({method:"POST",url:DuktVideosCms.getActionUrl("search",s),cache:!0}).success(function(t,n,r,s){e.videos=t;dkvideos.scroll.init();setTimeout(function(){dkvideos.modal.resize()},10);t.length<Dukt_videos.pagination_per_page?i.videoMore.off():i.videoMore.on();if(t.length>0){$(".dkv-main .dkv-empty").css("display","none");$(".dkv-main .dkv-videos").css("display","block")}else{$(".dkv-main .dkv-empty").css("display","block");$(".dkv-main .dkv-videos").css("display","none")}i.loader.off()}).error(function(e,t,n,r){})}t({method:"POST",url:DuktVideosCms.getActionUrl("services")}).success(function(r,s,o,u){$(".dkv-modal").removeClass("dkv-loading");e.services=r;$.each(e.services,function(n,r){t({method:"POST",url:DuktVideosCms.getActionUrl("userInfos",{providerClass:r.name})}).success(function(t,n,i,s){e.services[r.name].userInfos=t}).error(function(e,t,n,r){})});if(e.services.length==0){e.errorMessage="Set up a video service";$(".dkv-modal .dkv-noServices").css("display","block");$(".dkv-modal .dkv-servicesListCtrl").css("display","none");return!1}$.each(r,function(n,r){t({method:"POST",url:DuktVideosCms.getActionUrl("playlists",{providerClass:r.name})}).success(function(t,r,i,s){e.services[n].playlists=t}).error(function(e,t,n,r){})});$.each(e.services,function(t,n){if(i.serviceKey==t||typeof i.serviceKey=="undefined"){e.currentService=n;return!1}});e.serviceKey=e.currentService.name;(n.path()=="/"||n.path()=="")&&n.path(e.serviceKey+"/favorites")}).error(function(e,t,n,r){});e.serviceDropdown=function(){$(".dkv-sources").addClass("open")};e.serviceChange=function(t){$(".dkv-sources").removeClass("open");e.currentService=e.services[t];e.serviceKey=t;var r=i.methodName;r=="playlist"&&(r="favorites");n.path(t+"/"+r);s(function(){r=="search"&&a()},100)};e.clickedSomewhereElse=function(){$(".dkv-sources").removeClass("open")};e.isSourceSelected=function(t){return e.currentService==t?!0:!1};e.getClass=function(e){var t=new RegExp("/.*/"+e),r=n.path().match(t);return r?"active":""};var u=!1;e.search=function(){$(".dkv-search .dkv-press-enter").removeClass("dkv-hidden");var e=this.searchQuery;s(function(){if(e!=o.searchQuery)console.log("dont search because its different");else{console.log("search now");a()}},500);typeof this.searchQuery!="undefined"&&(o.searchQuery=this.searchQuery);o.searchQuery!=""?$(".dkv-search .dkv-press-enter").removeClass("dkv-hidden"):$(".dkv-search .dkv-press-enter").addClass("dkv-hidden")};$(document).on("keypress",".dkv-search input",function(e){e.keyCode=="13"&&a()})});